@page "/books"
@model RomanAra.MyfirstWebapp.Pages.BooksModel

@{
    ViewData["Title"] = "Books";
}

<div class="container my-4">
  <div class="row">
    <div class="col-12">
      <div class="card mb-3">
        <div class="card-body d-flex align-items-center">
          @{ var sf = Model.SearchField ?? "q"; }
          <form method="get" class="d-flex w-100">
            <select name="searchField" class="form-select me-2" style="max-width:160px;">
              @if (sf == "q") { <option value="q" selected>All</option> } else { <option value="q">All</option> }
              @if (sf == "title") { <option value="title" selected>Title</option> } else { <option value="title">Title</option> }
              @if (sf == "author") { <option value="author" selected>Author</option> } else { <option value="author">Author</option> }
            </select>

            <input class="form-control me-2" type="text" name="searchTerm" value="@Model.SearchTerm" placeholder="Search books (e.g., Harry Potter)..." />

            <div class="form-check form-check-inline me-2 align-self-center">
              @if (Model.HasFulltext)
              {
                <input class="form-check-input" type="checkbox" id="hasFulltext" name="hasFulltext" value="true" checked />
              }
              else
              {
                <input class="form-check-input" type="checkbox" id="hasFulltext" name="hasFulltext" value="true" />
              }
              <label class="form-check-label small" for="hasFulltext">Only fulltext</label>
            </div>

            <button type="submit" class="btn btn-primary">Search</button>
          </form>
        </div>
      </div>

      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Books</h5>
          <small class="text-muted">@((Model.ApiResponse != null) ? Model.ApiResponse.Count : 0) results</small>
        </div>
        <div class="card-body p-0">
          @if (!string.IsNullOrEmpty(Model.ErrorMessage))
          {
            <div class="alert alert-danger m-3">@Model.ErrorMessage</div>
          }

          <div class="table-responsive">
            <table class="table table-striped table-hover align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th></th>
                  <th>AuthorKey</th>
                  <th>AuthorName</th>
                  <th>CoverEdition</th>
                  <th>FirstPublishYear</th>
                  <th>BookAccess</th>
                  <th>EditionCount</th>
                  <th>Fulltext</th>
                  <th>LendingEdition</th>
                  <th>LendingIdentifier</th>
                </tr>
              </thead>
              <tbody>
                @if (Model.ApiResponse != null && Model.ApiResponse.Count > 0)
                {
                  foreach (var book in Model.ApiResponse)
                  {
                    <tr>
                      <td style="width:72px;">
                        @if (!string.IsNullOrEmpty(book.CoverEdition))
                        {
                          <img src="https://covers.openlibrary.org/b/olid/@(book.CoverEdition)-S.jpg" alt="cover" class="img-thumbnail" style="max-height:72px;" />
                        }
                        else
                        {
                          <div class="text-muted small">No image</div>
                        }
                      </td>
                      <td>@book.AuthorKey</td>
                      <td>@book.AuthorName</td>
                      <td>@book.CoverEdition</td>
                      <td>@book.FirstPublishYear</td>
                      <td>@book.BookAccess</td>
                      <td>@book.EditionCount</td>
                      <td>@book.Fulltext</td>
                      <td>@book.LendingEdition</td>
                      <td>@book.LendingIdentifier</td>
                    </tr>
                  }
                }
                else
                {
                  <tr>
                    <td colspan="10" class="text-center py-4">No books found for "@Model.SearchTerm"</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

